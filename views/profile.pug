<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
<link href="../static/fontawesome/css/all.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
style
    include ../static/websitecss/profile.css


<title>KUSTOM</title>
</head>
<body>
    <div class="loader-container">
        //-<i class="fa fa-bolt loader4" aria-hidden="true"></i>
        <i class="fab fa-android loader"></i>
        <i class="fas fa-cog loader2"></i>
        <i class="fas fa-cog loader3"></i>
    </div>
<div class="container1">
    <div class="banner"><button onclick="document.getElementById('user-popup-wrapper-responsive').style.display='block';" class="options-responsive"><i class="fas fa-bars"></i></button><h1 align=left><i class="fab fa-android fa-2x"></i>KUSTOMROM<font color="#DCDCDC">.com</font></h1>
    </div>
    <div class="dropdown"><button class="btn"><i class="fas fa-rss-square"></i> NEWS <i class="fas fa-angle-down"></i></span></button></h1>
        <div class="dropdown1-content">
            <a href="#">Link 1</a>
            <a href="#">Link 2</a>
            <a href="#">Link 3</a>
        </div>
    </div>
    <div class="dropdown"><button class="btn"><i class="fas fa-mobile-alt"></i> DEVICES <i class="fas fa-angle-down"></i></button>
        <div class="dropdown1-content">
            <table>
                <tr>
                    <td><a href="/samsung">SAMSUNG</a></td>
                    <td><a href="#">HTC</a></td>
                    <td><a href="/xiaomi">Xiaomi</a></td>
                </tr>
                <tr>
                    <td><a href="#">OPPO</a></td>
                    <td><a href="#">VIVO</a></td>
                    <td><a href="/oneplus">ONE_PLUS</a></td>
                </tr>
                <tr>
                    <td><a href="#">RAZOR</a></td>
                    <td><a href="/motorola">MOTOROLA</a></td>
                    <td><a href="/google">GOOGLE</a></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="dropdown"><button class="btn"><i class="fab fa-forumbee"></i> FORUMS <i class="fas fa-angle-down"></i></button>
        <div class="dropdown1-content">
            <a href="#">Link 7</a>
            <a href="#">Link 8</a>
            <a href="#">Link 9</a>
        </div>
    </div>
    <div class="dropdown"><button class="btn bestposts"><i class="fas fa-coffee"></i> BEST POSTS <i class="fas fa-angle-down"></i></button>
        <div class="dropdown1-content">
            <a href="#">Link 10</a>
            <a href="#">Link 11</a>
            <a href="#">Link 12s</a>
        </div>
    </div>
    <div class="dropdown"><button class="btn"> <i class="fas fa-user-tie"></i> DEVELOPERS</button>
    </div>
    <div class="search-box">
        <input type="text" class="search-txt" id="search-txt" placeholder="Type to search">
        <i class="fab fa-searchengin search-btn"></i>
        <div class="search-result-box">
            <span style="color:thistle;padding:15px;margin: 10px 0px;">Search Results</span>
            <hr style="background-color:thistle;margin-top:5px;width:90%;">
            <ul id="allSearchResults">
                //-all search results here
            </ul>
        </div>
    </div>
</div>


<div class="content clearfix">
    <div class="main-content">
        <div class="basic-data">
            <div class="right-side">
                <ul>
                    <li>Username: <span>#{userInfo.username}</span> </li>
                    <li>Name : <span>#{userInfo.name}</span></li>
                    <li>Usertype: <span>dev</span></li>
                    <li>Joining Date : <span>#{userInfo.date}</span></li>
                    <li>City : <span>#{userInfo.city}</span></li>
                    <li>Home Country : <span>#{userInfo.country}</span></li>
                    <li>Occupation : <span>#{userInfo.occupation}</span></li>
                    <li>Telegram Link : <a href="#">#{userInfo.telegram}</a></li>
                    <li>Instagram Link : <a href="#">#{userInfo.instagram}</a></li>
                    <li>Paypal Donation : <span>#{userInfo.paypal}</span></li>
                    <li>Gpay/Phonepe Link : <span>#{userInfo.gpay}</span></li>
                    <li>Devices : <span>#{userInfo.device}</span></li>
                </ul>
            </div>
            <div class="left-side">
                <div class="image-section">
                    <img src="../static/uploads/#{userInfo.filename}">
                </div>
            </div>
        </div>

        <div class="work">
            <span style="color:white;font-size:20px;"><strong>Projects</strong></span>
                <hr style="background-color:white;margin-top:0;">
                    <table class="allprojects">
                        <tr>
                            <th style="color: #0ac5a8;">Project Name</th>
                            <th style="color: #0ac5a8;">Version</th>
                            <th style="color: #0ac5a8;">Android</th>
                            <th style="color: #0ac5a8;">Device</th>
                            <th style="color: #0ac5a8;">Date</th>
                            <th style="color: #0ac5a8;">Downloads</th>
                            <th style="color: #0ac5a8;">Avg. Rating</th>
                            <th style="color: #0ac5a8;"></th>
                        </tr>
                    </table>
        </div>
        <div class="container">
            <div class="chart-box-1">
            <p style="color:#0ac5a8;font-size: 1rem;"><u>Rating</u></p>
                <div class="chart1">
                    <canvas id="myChart1"></canvas>
                </div>
                <div class="chart1-report">
                </div>
            </div>
            <div class="chart-box-2">
                <p style="color:#0ac5a8;font-size: 1rem;"><u>Contribution to KUSTOM</u></p>
                <div class="chart2">
                    <canvas id="myChart2"></canvas>
                </div>
                <div class="chart2-report">
                </div>
            </div>
        </div>
    </div>


    <div class="side-content">
        <h5 class="side-post-title">&nbsp; ysl feed</h5>
        <div class="side-post">
            <a href="#"><img src="../static/postimages/p5.jpg" alt="" class="side-post-image"></a>
            <div class="side-post-preview">
                <h4><a class="sidepostlink" href="#">India bans Xiaomi’s Mi Browser Pro, and QQ International app</a></h4> 
                <p class="side-preview-text">
                The Government of India recently had banned and blocked access to 59 apps with Chinese connections like TikTok, Xiaomi’s Mi Community, Mi Video Call, Xender, Shareit, Cam Scanner and even...
                </p>
            </div>
        </div>
        <div class="side-post">
            <a href="#"><img src="../static/postimages/p9.jpg" alt="" class="side-post-image"></a>
            <div class="side-post-preview">
                <h4><a class="sidepostlink" href="#">Motorola One Fusion+ Review – A harmonious blend of the right mid-range features.</a></h4> 
                <p class="side-preview-text">For the last couple of years, Motorola has given its undivided attention to its portfolio of budget and mid-range smartphones. With a shift away from its flagship Moto Z line,…</p>
            </div>
        </div>
        <div class="side-post">
            <a href="#"><img src="../static/postimages/p10.jpg" alt="" class="side-post-image"></a>
            <div class="side-post-preview">
                <h4><a class="sidepostlink" href="#">OnePlus Nord Review: Great Performance at a Great Price</a></h4> 
                <p class="side-preview-text">Every OnePlus smartphone since the 2014 OnePlus One has featured a flagship Qualcomm Snapdragon 800 series chipset. The use of Qualcomm's latest silicon has been integral to OnePlus' marketing, as…</p>
            </div>
        </div>
    </div>


<div class="options-container">
    <button onclick="document.querySelector('.options-container').style.display='none';" class="close"><i class="fas fa-times-circle"></i></button>
    <div class="options-links">
        <div class="social-box-2">
            <span style="color:thistle;font-size:small;">RESOURCES</span>
                <a class="options-here" href="#">Contact Us</a>
                <a class="options-here" href="#">About Us</a>
                <a style="font-weight:1000;" class="options-here" href="#">Tip Us</a>
        </div>
        <div class="social-box-2">
            <span style="color:thistle;font-size:small;">SOCIAL</span>
            <div class="icons">
                <a href="#" class="social-icons"><i class="fab fa-facebook-square"></i></a>
                <a href="#" class="social-icons"><i class="fab fa-telegram"></i></a>
                <a href="#" class="social-icons"><i class="fab fa-twitter-square"></i></a>
                <a href="#" class="social-icons"><i class="fas fa-share-alt-square"></i></a>
            </div>
        </div>
    </div>
</div>




<div class="side-bar">
    <h2><button onclick="options();" class="options"><i class="fas fa-bars"></i></button>
    <button onclick="document.getElementById('user-popup-wrapper').style.display='block'" class="user"><i class="fas fa-user-circle"></i></button></h2>
    <div class="social-links">
        <a href="www.facebook.com"><img src="../static/logo/fb.png"></a>
        <a href="www.instagram.com"><img src="../static/logo/insta.png"></a>
        <a href="www.twitter.com"><img src="../static/logo/twitter.png"></a>
    </div>
    <div class="useful-links">
        <a href="#"><img src="../static/logo/share.png"></a>
        <a href="#"><img src="../static/logo/info.png"></a>
    </div>
</div>


<div id="user-popup-wrapper-responsive" class="user-popup-responsive">
    <button onclick="document.getElementById('user-popup-wrapper-responsive').style.display='none';" class="close"><i class="fas fa-times-circle"></i></button>
    if(isAuthenticated)  
        if user.usertype == 'local'    
            <div class="user-popup-content">
                <div class="dpcontainer"><img style="width:150px;height:150px;border-radius:50%;" src="../static/uploads/#{user.filename}" ></div>
                <div class="usernaming">
                    <p style="margin-top:0;color:white;font-size:1rem;">#{ user.username }</p>
                </div>
                <a href="/accountdetails" class="user-options"> Account details</a>
                <a href="/usersecurity" class="user-options"> Password and Security</a>
                <a href="#" class="user-options"><i class="fas fa-cogs"></i> Settings</a>
                <a href="/logout" class="user-options"><i class="fas fa-sign-out-alt"></i> Log Out</a><br>
            </div>
        else if user.usertype == 'developer'
            <div class="user-popup-content">
                <div class="dpcontainer"><img style="width:150px;height:150px;border-radius:50%;" src="../static/uploads/#{user.filename}" ></div>
                <div class="usernaming">
                    <p style="margin-top:0;color:white;font-size:1rem;">#{ user.username }</p>
                </div>
                <p style="margin-top:0;color:white;font-size:1rem;">User-Type: #{ user.usertype }</p>
                <a href="/logout" class="logout"><i class="fas fa-sign-out-alt"></i> Log Out</a><br>
                <a href="#" class="settings"><i class="fas fa-cogs"></i> Settings</a><br>
                <a href="/dashboard" class="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            </div>
    else
        <div class="user-popup-content">

            div.col-10.ml-sm-auto.px-4
                if error != 0
                    div.alert.alert-danger.alert-dismissible.fade.show #{ error }
                if typeof errors != 'undefined'
                    for error in errors
                        div.alert.alert-danger.alert-dismissible.fade.show #{ error.msg }
                if success_msg != 0
                    div.alert.alert-success.alert-dismissible.fade.show #{ success_msg }
                if error_msg != 0
                    div.alert.alert-danger.alert-dismissible.fade.show #{ error_msg }
            <form action="/login" method='POST'>
                <div class="login-data">
                    <span style="color:thistle;font-size:large;"><i class="far fa-user"></i> Hello!, Sign in</span>
                    <input type="email" id="email" name="email" class="email" placeholder="Your @email ">
                    <input type="password" id="password" name="password" placeholder="password">
                    <p align="right"><a href="#" class="forgotpassword">forgot password?</a></p>
                    <a href="/login" ><button type="submit" name="login" class="login">LOGIN</button></a>
                    <a href="/registration" class="register">Register</a><span style="color:#DCDCDC;"> or </span><a href="#" class="loginwithgoogle">Login with google</a>
                </div>
            </form>
        </div>
    <div class="social-box">
    <span style="color:thistle;font-size:small;">RESOURCES</span>
        <ul>
            <li><a>Contact Us</a></li>
            <li><a>About Us</a></li>
            <li><a>Tip Us</a></li>
        </ul>
    </div>
    <div class="social-box">
        <span style="color:thistle;font-size:small;">SOCIAL</span>
        <div class="icons">
            <a class="social-icons"><i class="fab fa-facebook-square"></i></a>
            <a class="social-icons"><i class="fab fa-telegram"></i></a>
            <a class="social-icons"><i class="fab fa-twitter-square"></i></a>
            <a class="social-icons"><i class="fas fa-share-alt-square"></i></a>
        </div>
    </div>
</div>

<div id="user-popup-wrapper" class="user-popup">
    <button onclick="document.getElementById('user-popup-wrapper').style.display='none';" class="close"><i class="fas fa-times-circle"></i></button>
    if(isAuthenticated)  
        if user.usertype == 'local'    
            <div class="user-popup-content">
            <div class="dpcontainer"><img style="width:150px;height:150px;border-radius:50%;" src="./static/uploads/#{user.filename}" ></div>
            <div class="usernaming">
                <p style="margin-top:0;color:white;font-size:1rem;">#{ user.username }</p>
            </div>
                <a href="/accountdetails" class="user-options"> Account details</a>
                <a href="/usersecurity" class="user-options"> Password and Security</a>
                <a href="#" class="user-options"><i class="fas fa-cogs"></i> Settings</a>
                <a href="/logout" class="user-options"><i class="fas fa-sign-out-alt"></i> Log Out</a><br>
            </div>
        else if user.usertype == 'developer'
            <div class="user-popup-content">
            <div class="dpcontainer"><img style="width:150px;height:150px;border-radius:50%;" src="./static/uploads/#{user.filename}" ></div>
            <div class="usernaming">
            <p style="margin-top:0;color:white;font-size:1rem;">#{ user.username }</p>
            </div>
            <p style="margin-top:0;color:white;font-size:1rem;">User-Type: #{ user.usertype }</p>
            <a href="/logout" class="logout"><i class="fas fa-sign-out-alt"></i> Log Out</a><br>
            <a href="#" class="settings"><i class="fas fa-cogs"></i> Settings</a><br>
            <a href="/dashboard" class="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            </div>
    else
        <div class="user-popup-content">

        div.col-10.ml-sm-auto.px-4
            if error != 0
                div.alert.alert-danger.alert-dismissible.fade.show #{ error }
            if typeof errors != 'undefined'
                for error in errors
                    div.alert.alert-danger.alert-dismissible.fade.show #{ error.msg }
            if success_msg != 0
                div.alert.alert-success.alert-dismissible.fade.show #{ success_msg }
            if error_msg != 0
                div.alert.alert-danger.alert-dismissible.fade.show #{ error_msg }
        <form action="/login" method='POST'>
            <div class="login-data">
                <input type="email" id="email" name="email" class="email" placeholder="Your @email ">
                <input type="password" id="password" name="password" placeholder="password">
                <p align="right"><a href="#" class="forgotpassword">forgot password?</a></p>
                <a href="/login" ><button type="submit" name="login" class="login">LOGIN</button></a>
                <a href="/registration" class="register">Register</a><span style="color:#DCDCDC;"> or </span><a href="#" class="loginwithgoogle">Login with google</a>
            </div>
        </form>
        </div>
    </div>
</div>

    <div class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h1><i class="fab fa-android fa-2x"></i>KUSTOMROM<font color="#DCDCDC">.com</font></h1>
                <p style="color:#DCDCDC;">This is a community where you will find custom rom for your devices. Flash Happiness!!</p>
                <div class="contact">
                    <span style="color:#DCDCDC;"><i class="fas fa-phone-square-alt"></i> &nbsp; 933-703-5249</span><br>
                    <span style="color:#DCDCDC;"><i class="far fa-paper-plane"></i>&nbsp; thisisniraj2@gmail.com</span>
                </div>
            </div>
            <div class="footer-section links">
                <h6>Quick Links</h6>
                <br>
                <a href="#">Guides</a>
                <a href="#">ROM</a>
                <a href="#">Devices</a>
                <a href="#">News</a>
            </div>
            <div class="footer-section subscribe">
                <h7>Subscribe to KUSTOM</h7>
                <p style="color: #DCDCDC; font-size:1rem; text-align:left;width:90%;">Receive the freshest Android & development news right in your inbox!</p>
                <form action="subscribe.html" method="post">
                    <input type="email" name="email" class="contact-input" placeholder="your@email"><br>
                    <button style="margin-left:10px;color:#DCDCDC;background-color:#0AC5A8;padding: 4px 4px;border:none;border-radius:5px;"type="submit" class="submit"><i class="fas fa-smile-beam"></i> Subscribe</button>
                </form>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; kustomrom.com | Designed by Niraj Sharma</p>
        </div>
    </div>

script.
    window.onload = function(){
        let username = "#{userInfo.username}";
        const lists = document.querySelector(".allprojects");
        function appendList(data,average){
            trTag=document.createElement('tr');
            let markup=`
                <td><a href="/${data.projectname}-${data.device}">${data.projectname}[${data.romversion}][${data.androidversion}][${data.device}]</a></td>
                <td>${data.romversion}</td>
                <td>${data.androidversion}</td>
                <td>${data.device}</td>
                <td>${data.date}</td>
                <td>${data.downloads}</td>
                <td>${isNaN(average)?0:average}</td>     
            `;
            trTag.innerHTML+=markup;
            lists.append(trTag);
        }

        fetchTemplates();
            function fetchTemplates(){
                fetch('/api/ysltemplates')
                    .then(res => res.json())
                    .then(result => {
                        var projectCount=0,totalProjects=0;
                        for(i=0;i<result.length;i++){
                            totalProjects+=1;
                            var average=0,count=0,sum=0;
                            if(username==result[i].username){
                                projectCount+=1;
                                    result[i].raters.forEach(info=>{
                                        if(info.rated>0){
                                            count+=1;
                                        }
                                        sum+=info.rated;
                                    })
                                average=Math.round(sum/count);
                                //console.log('average rating:'+average);
                                appendList(result[i],average);

                                if(result[i].projectname=='havocOs' && result[i].device=='ysl' && result[i].romversion=='3.3'){
                                    var count5=0,count4=0,count3=0,count2=0,count1=0;
                                    result[i].raters.forEach(info=>{
                                        console.log(info.username)
                                        if(info.rated==5)
                                        {
                                            count5+=1;
                                        }
                                        else if(info.rated==4)
                                        {
                                            count4+=1;
                                        }
                                        else if(info.rated==3)
                                        {
                                            count3+=1;
                                        }
                                        else if(info.rated==2)
                                        {
                                            count2+=1;
                                        }
                                        else if(info.rated==1)
                                        {
                                            count1+=1;
                                        }
                                    })
                                    console.log('checking'+count5,count4,count3,count2,count1);
                                    drawChart1(count5,count4,count3,count2,count1);
                                }
                            }
                        }console.log("total"+projectCount+"out of"+totalProjects);
                        var otherProjects = totalProjects - projectCount;
                        drawChart2(projectCount,otherProjects,totalProjects);
                    })
            }
    }
    function drawChart1(q,w,e,r,t){
        let ctx = document.getElementById('myChart1').getContext('2d');
        let labels = ['rated-5','rated-4','rated-3','rated-2','rated-1'];
        let colorHex = ['#FB3640','#EFCA08','#43AA88','#253D5B','#000000'];
        let total = q+w+e+r+t;
        let report1 = document.querySelector('.chart1-report');
        let markup = `
            <ul class="report1-ul">
                <li>Rated-5: <span style="color:white;">${q}</span></li>
                <li>Rated-4: <span style="color:white;">${w}</span></li>
                <li>Rated-3: <span style="color:white;">${e}</span></li>
                <li>Rated-2: <span style="color:white;">${r}</span></li>
                <li>Rated-1: <span style="color:white;">${t}</span></li>
            </ul>
        `;
        report1.innerHTML+=markup;
        let myChart = new Chart(ctx,{
            type: 'pie',
            data: {
                datasets: [{
                    data:[q,w,e,r,t],
                    backgroundColor: colorHex
                }],
                labels: labels
            },
            options: {
                responsive: true,
                legend: {
                    position: 'top'
                },
                plugins: {
                    datalabels: {
                        color: '#fff',
                        anchor: 'end',
                        align: 'start',
                        offset:-10,
                        borderWidth: 2,
                        borderColor: '#fff',
                        borderRadius: 25,
                        backgroundColor: (context)=>{
                            return context.dataset.backgroundColor;
                        },
                        font: {
                            weight: 'bold',
                            size: '10'
                        },
                        formatter: (value)=>{
                            return ((value*100)/total).toFixed(2) + '%';
                        }
                    }
                }
            }
        });
    }
    function drawChart2(pc,op,tp){
        let user='#{userInfo.username}';
        let ctx = document.getElementById('myChart2').getContext('2d');
        let labels = [user,'Other Users'];
        let colorHex = ['#FF0800','#39ff14'];
        let report2 = document.querySelector('.chart2-report');
        let markup = `
            <ul class="report2-ul">
                <li>Total-Projects: <span style="color:white;">${tp}</span></li>
                <li>${user}-projects: <span style="color:white;">${pc}</span></li>
            </ul>
        `;
        report2.innerHTML+=markup;
        let myChart = new Chart(ctx,{
            type: 'pie',
            data: {
                datasets: [{
                    data:[pc,op],
                    backgroundColor: colorHex
                }],
                labels: labels
            },
            options: {
                responsive: true,
                legend: {
                    position: 'top'
                },
                plugins: {
                    datalabels: {
                        color: '#fff',
                        anchor: 'end',
                        align: 'start',
                        offset:-10,
                        borderWidth: 2,
                        borderColor: '#fff',
                        borderRadius: 25,
                        backgroundColor: (context)=>{
                            return context.dataset.backgroundColor;
                        },
                        font: {
                            weight: 'bold',
                            size: '10'
                        },
                        formatter: (value)=>{
                            return ((value*100)/tp).toFixed(2) + '%';
                        }

                    }
                }
            }
        });
    }

    const resultList = document.getElementById('allSearchResults');
    const searchBar = document.getElementById('search-txt');
    let tags=[];
    searchBar.addEventListener('keyup',(e)=>{
        document.querySelector('.search-result-box').style.display='block';
        //console.log(e);
        const searchString = e.target.value.toLowerCase();
        const filteredTags = tags.filter(key=>{
        return(
            key.heading.toLowerCase().includes(searchString) || 
            key.description.toLowerCase().includes(searchString)
        );
        });
        //console.log(filteredTags);
        displayTags(filteredTags);
    });
    fetchTags();
        function fetchTags(){
        fetch('/api/searchTags')
            .then(res => res.json())
            .then(result => {
            tags=result;
            })
        }
    function displayTags(tags){
        //console.log(searchBar.value.length)
        if(tags.length==0){
        const htmlString=  `
            <li class="searchresults">
                <span style="color:thistle;">No Results</span>
            </li>
            `;
        resultList.innerHTML=htmlString;
        }
        else if(searchBar.value.length==0){
            document.querySelector('.search-result-box').style.display='none';
        }
        else{
            const htmlString= tags
            .map((data)=>{
            return `
                <li class="searchresults">
                    <a class="result-heading" href=${data.link}>${data.heading}[${data.date}]</a>
                    <a class="result-description" href=${data.link}>${data.description}</a>
                </li>
                `;
            })
        resultList.innerHTML=htmlString;
        }
    }
    function options(){
    const option = document.querySelector('.options-container');
    if(option.style.display=='block'){
        option.style.display='none';
    }
    else{
        option.style.display='block';
    }
    }
    setTimeout(()=>{
        const preloader = document.querySelector('.loader-container');
        preloader.style.display='none';
    },3000);




</body>
</html>